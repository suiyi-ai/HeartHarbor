# 讯飞虚拟人使用指南

## 功能概述

讯飞虚拟人是一个基于WebSocket协议的AI交互功能，能够实现与虚拟AI助手的实时对话和视频流展示。

## 主要功能特性

### 🎯 核心功能
- **实时对话交互**：支持文本消息与虚拟人交流
- **WebSocket连接**：稳定可靠的实时通信
- **视频流展示**：模拟虚拟人视频流效果
- **状态管理**：完整的连接状态监控

### 🛠️ 技术特性
- **兼容性**：支持小程序和浏览器环境
- **自动重连**：网络异常时自动重连机制
- **错误处理**：完善的错误提示和处理机制
- **性能优化**：连接超时控制和状态管理

## 快速开始

### 1. 访问虚拟人页面
在应用中导航到虚拟人页面，路径为：`pages/virtual-human/xf-virtual-human`

### 2. 初始化虚拟人
- 系统会自动初始化SDK
- 检查API配置是否正确
- 建立WebSocket连接

### 3. 启动虚拟人
- 点击"启动虚拟人"按钮
- 等待连接建立（约5-10秒）
- 虚拟人准备就绪后开始交互

## API配置说明

### 默认配置
组件预置了讯飞API的默认配置：
```javascript
{
  serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact',
  appId: '8b636816',
  apiKey: '62911d28b5b7013c52ec2ef3cc3ced71',
  apiSecret: 'ODcxM2QwNmQxMWQzMTQzYWUwNWNhN2Zm',
  sceneId: '241473910644805632',
  avatarId: '110022006',
  voiceType: 'x4_yezi'
}
```

### 自定义配置
如需使用自己的API配置：
1. 点击页面右上角"API配置"按钮
2. 填写您的API信息
3. 点击"保存配置"
4. 配置会自动保存到本地存储

## 使用流程

### 正常使用流程
1. **初始化** → 系统自动完成
2. **连接建立** → WebSocket连接成功
3. **启动虚拟人** → 发送启动协议
4. **交互对话** → 发送文本消息
5. **结束会话** → 停止虚拟人

### 异常处理流程
1. **连接断开** → 自动重连机制
2. **API错误** → 显示错误信息
3. **网络异常** → 提示检查网络

## 状态说明

### 连接状态
- 🔴 **未连接**：WebSocket未建立连接
- 🟡 **连接中**：正在建立连接
- 🟢 **已连接**：连接成功建立

### 虚拟人状态
- ⏹️ **已停止**：虚拟人未启动
- 🔄 **启动中**：正在启动虚拟人
- ▶️ **播放中**：虚拟人正常运行

## 交互功能

### 文本对话
- 在输入框输入消息
- 点击发送或按回车键
- 虚拟人会回复相关内容

### 语音交互（开发中）
- 点击语音交互按钮
- 功能正在开发完善

## 故障排除

### 常见问题

#### 1. 连接失败
- **原因**：网络问题或API配置错误
- **解决**：检查网络连接和API配置

#### 2. 虚拟人启动失败
- **原因**：API配额不足或配置错误
- **解决**：检查API配额和配置信息

#### 3. 消息发送失败
- **原因**：连接断开或网络异常
- **解决**：等待自动重连或手动重连

### 调试信息
组件提供详细的日志信息，可在浏览器控制台查看：
- 连接建立过程
- 消息发送状态
- 错误信息详情

## 技术架构

### 通信协议
- **协议**：WebSocket (wss://)
- **认证**：HMAC-SHA256签名
- **数据格式**：JSON

### 核心方法
```javascript
// 认证URL生成
generateAuthUrl()

// WebSocket连接管理
connectWebSocket()
closeWebSocket()
reconnect()

// 协议构建
buildStartRequest()
buildTextRequest()
buildStopRequest()

// 消息处理
handleWebSocketMessage()
```

## 兼容性说明

### 支持环境
- ✅ 微信小程序
- ✅ H5浏览器
- ✅ App端

### 技术要求
- WebSocket协议支持
- CryptoJS库（加密功能）
- Base64编码支持

## 性能优化

### 连接优化
- 连接超时控制（10秒）
- 自动重连机制
- 心跳检测

### 内存管理
- 连接断开时资源释放
- 定时器清理
- 状态重置

## 扩展开发

### 功能扩展建议
1. **语音识别**：集成语音输入功能
2. **表情识别**：添加情感分析
3. **多语言支持**：国际化配置
4. **自定义虚拟人**：支持多种虚拟人形象

### 技术扩展
1. **协议扩展**：支持更多交互协议
2. **性能监控**：添加性能指标监控
3. **日志系统**：完善日志记录

## 安全说明

### 数据安全
- API密钥本地加密存储
- WebSocket使用wss安全协议
- 敏感信息不记录日志

### 使用限制
- 遵守讯飞API使用条款
- 注意API调用频率限制
- 合理使用资源

---

**最后更新**：2025年1月
**版本**：v1.0.0