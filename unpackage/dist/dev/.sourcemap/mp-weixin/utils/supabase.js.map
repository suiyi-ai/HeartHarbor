{"version":3,"file":"supabase.js","sources":["utils/supabase.js"],"sourcesContent":["\"use strict\";\r\nconst common_vendor = require(\"../common/vendor.js\");\r\nconst SUPABASE_CONFIG = {\r\n  url: \"https://etvdmnsernfiegfeadad.supabase.co\",\r\n  anonKey: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0dmRtbnNlcm5maWVnZmVhZGFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NzM1MDUsImV4cCI6MjA3NzQ0OTUwNX0.FNvK-NrAxGrY5TwYblFC__hScR9lxjC5VFEUPlMYtTY\"\r\n};\r\nfunction generateUUID() {\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\r\n    const r = Math.random() * 16 | 0;\r\n    const v = c === \"x\" ? r : r & 3 | 8;\r\n    return v.toString(16);\r\n  });\r\n}\r\nfunction isValidUUID(uuid) {\r\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n  return uuidRegex.test(uuid);\r\n}\r\nfunction convertLegacyUserId(legacyId) {\r\n  if (isValidUUID(legacyId)) {\r\n    return legacyId;\r\n  }\r\n  const hash = legacyId.split(\"\").reduce((a, b) => {\r\n    a = (a << 5) - a + b.charCodeAt(0);\r\n    return a & a;\r\n  }, 0);\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\r\n    const r = (hash + Math.random() * 16) % 16 | 0;\r\n    const v = c === \"x\" ? r : r & 3 | 8;\r\n    return v.toString(16);\r\n  });\r\n}\r\nfunction getUserId() {\r\n  let userId = common_vendor.index.getStorageSync(\"user_id\");\r\n  if (!userId) {\r\n    userId = generateUUID();\r\n    common_vendor.index.setStorageSync(\"user_id\", userId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:49\", \"生成新用户ID（UUID格式）:\", userId);\r\n  } else if (!isValidUUID(userId)) {\r\n    const newUserId = convertLegacyUserId(userId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:53\", \"转换旧用户ID格式:\", userId, \"->\", newUserId);\r\n    userId = newUserId;\r\n    common_vendor.index.setStorageSync(\"user_id\", userId);\r\n  }\r\n  return userId;\r\n}\r\nfunction buildSupabaseQuery(params) {\r\n  const parts = [];\r\n  Object.keys(params).forEach((key) => {\r\n    const value = params[key];\r\n    if (value !== null && value !== void 0) {\r\n      if (key === \"select\") {\r\n        parts.push(`select=${encodeURIComponent(value)}`);\r\n      } else if (key === \"order\") {\r\n        parts.push(`order=${encodeURIComponent(value)}`);\r\n      } else {\r\n        parts.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\r\n      }\r\n    }\r\n  });\r\n  return parts.join(\"&\");\r\n}\r\nfunction handleSupabaseError(response, url, options) {\r\n  let errorMessage = `API Error: ${response.statusCode}`;\r\n  if (response.data) {\r\n    if (response.data.message) {\r\n      errorMessage += ` - ${response.data.message}`;\r\n      if (response.data.message.includes(\"invalid input syntax for type uuid\")) {\r\n        errorMessage += \" (用户ID格式错误，已自动修复)\";\r\n        const oldUserId = common_vendor.index.getStorageSync(\"user_id\");\r\n        const newUserId = generateUUID();\r\n        common_vendor.index.setStorageSync(\"user_id\", newUserId);\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:100\", \"检测到UUID格式错误，已重新生成用户ID:\", {\r\n          oldUserId,\r\n          newUserId\r\n        });\r\n      }\r\n    }\r\n    if (response.data.hint) {\r\n      errorMessage += ` (${response.data.hint})`;\r\n    }\r\n    if (response.data.details) {\r\n      errorMessage += ` [${response.data.details}]`;\r\n    }\r\n  }\r\n  common_vendor.index.__f__(\"error\", \"at utils/supabase.js:114\", \"Supabase API错误详情:\", {\r\n    url,\r\n    method: options.method,\r\n    statusCode: response.statusCode,\r\n    error: errorMessage,\r\n    responseData: response.data\r\n  });\r\n  return new Error(errorMessage);\r\n}\r\nasync function migrateUserData() {\r\n  const oldUserId = common_vendor.index.getStorageSync(\"user_id_legacy\");\r\n  const currentUserId = common_vendor.index.getStorageSync(\"user_id\");\r\n  if (!oldUserId && currentUserId && !isValidUUID(currentUserId)) {\r\n    common_vendor.index.setStorageSync(\"user_id_legacy\", currentUserId);\r\n    const newUserId = generateUUID();\r\n    common_vendor.index.setStorageSync(\"user_id\", newUserId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:138\", \"执行用户数据迁移:\", {\r\n      oldUserId: currentUserId,\r\n      newUserId\r\n    });\r\n    return newUserId;\r\n  }\r\n  return currentUserId;\r\n}\r\nclass SupabaseService {\r\n  constructor() {\r\n    this.userId = getUserId();\r\n    this.isConnected = false;\r\n    this.initConnection();\r\n  }\r\n  // 初始化连接（修复版本）\r\n  async initConnection() {\r\n    try {\r\n      await migrateUserData();\r\n      if (!isValidUUID(this.userId)) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:165\", \"用户ID格式无效，重新生成:\", this.userId);\r\n        this.userId = generateUUID();\r\n        common_vendor.index.setStorageSync(\"user_id\", this.userId);\r\n      }\r\n      \r\n      // 直接测试连接，不依赖isConnected状态\r\n      const testResult = await this.testConnection();\r\n      this.isConnected = true;\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:172\", \"Supabase MCP连接成功，用户ID:\", this.userId);\r\n      return testResult;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:174\", \"Supabase MCP连接失败，将使用降级方案:\", error);\r\n      this.isConnected = false;\r\n      throw error;\r\n    }\r\n  }\r\n  // 测试连接（修复版本）\r\n  async testConnection() {\r\n    const url = `${SUPABASE_CONFIG.url}/rest/v1/conversations?limit=1`;\r\n    const options = {\r\n      method: \"GET\",\r\n      header: {\r\n        \"apikey\": SUPABASE_CONFIG.anonKey,\r\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      timeout: 10e3\r\n    };\r\n    \r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:175\", \"测试Supabase连接:\", url);\r\n    \r\n    try {\r\n      const response = await common_vendor.index.request({\r\n        url,\r\n        ...options\r\n      });\r\n      \r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:183\", \"连接测试响应状态码:\", response.statusCode);\r\n      \r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return response.data;\r\n      } else {\r\n        throw handleSupabaseError(response, url, options);\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:191\", \"Supabase连接测试失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // API调用方法\r\n  async callApi(endpoint, options = {}) {\r\n    if (!this.isConnected) {\r\n      throw new Error(\"Supabase连接不可用，请检查网络连接\");\r\n    }\r\n    let url = `${SUPABASE_CONFIG.url}/rest/v1/${endpoint}`;\r\n    const defaultOptions = {\r\n      method: \"GET\",\r\n      header: {\r\n        \"apikey\": SUPABASE_CONFIG.anonKey,\r\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\r\n        \"Content-Type\": \"application/json\",\r\n        \"Prefer\": \"return=representation\"\r\n      },\r\n      timeout: 15e3\r\n    };\r\n    if (options.queryParams) {\r\n      const queryString = buildSupabaseQuery(options.queryParams);\r\n      if (queryString) {\r\n        url += \"?\" + queryString;\r\n      }\r\n    }\r\n    const finalOptions = {\r\n      ...defaultOptions,\r\n      ...options,\r\n      url,\r\n      header: {\r\n        ...defaultOptions.header,\r\n        ...options.header || {}\r\n      }\r\n    };\r\n    if ((options.method === \"POST\" || options.method === \"PATCH\") && options.data) {\r\n      finalOptions.data = JSON.stringify(options.data);\r\n    }\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:236\", `MCP API调用: ${finalOptions.method} ${url}`);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:237\", \"查询参数:\", options.queryParams);\r\n    try {\r\n      const response = await common_vendor.index.request(finalOptions);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:242\", \"API响应状态码:\", response.statusCode);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:243\", \"API响应数据:\", response.data);\r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return response.data;\r\n      } else {\r\n        throw handleSupabaseError(response, url, options);\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:251\", \"Supabase API调用失败:\", error);\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:252\", \"请求详情:\", {\r\n        url,\r\n        method: finalOptions.method,\r\n        headers: finalOptions.header\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n  // 创建新对话（修复版本）\r\n  async createConversation(title, roleId, styleId) {\r\n    try {\r\n      const data = {\r\n        user_id: this.userId,\r\n        title: title || \"新对话\",\r\n        role_id: roleId,\r\n        style_id: styleId,\r\n        is_active: true,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString(),\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:274\", \"MCP: 创建对话，数据:\", data);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:285\", \"MCP: 创建对话成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:288\", \"MCP: 创建对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取用户的所有对话（修复HTTP 400错误）\r\n  async getUserConversations() {\r\n    try {\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:296\", \"MCP: 获取用户对话，用户ID:\", this.userId);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          user_id: `eq.${this.userId}`,\r\n          is_active: \"eq.true\",\r\n          select: \"*\"\r\n        }\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:307\", \"MCP: 获取对话成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:310\", \"MCP: 获取用户对话失败:\", error);\r\n      return [];\r\n    }\r\n  }\r\n  // 获取对话的详细信息（修复版本）\r\n  async getConversation(conversationId) {\r\n    try {\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:319\", \"MCP: 获取对话详情，对话ID:\", conversationId);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${conversationId}`,\r\n          select: \"*\"\r\n        }\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:329\", \"MCP: 获取对话详情成功:\", result ? result[0] : null);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:332\", \"MCP: 获取对话详情失败:\", error);\r\n      return null;\r\n    }\r\n  }\r\n  // 获取对话的所有消息（修复版本）\r\n  async getConversationMessages(conversationId) {\r\n    try {\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:340\", \"MCP: 获取对话消息，对话ID:\", conversationId);\r\n      const result = await this.callApi(\"messages\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          conversation_id: `eq.${conversationId}`,\r\n          order: \"created_at.asc\",\r\n          select: \"*\"\r\n        }\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:351\", \"MCP: 获取消息成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:354\", \"MCP: 获取对话消息失败:\", error);\r\n      return [];\r\n    }\r\n  }\r\n  // 保存消息（修复版本）\r\n  async saveMessage(conversationId, role, content) {\r\n    try {\r\n      const data = {\r\n        conversation_id: conversationId,\r\n        role,\r\n        content,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:369\", \"MCP: 保存消息，数据:\", data);\r\n      const result = await this.callApi(\"messages\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:380\", \"MCP: 保存消息成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:383\", \"MCP: 保存消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 更新对话标题（修复版本）\r\n  async updateConversationTitle(conversationId, title) {\r\n    try {\r\n      const data = {\r\n        title,\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:396\", \"MCP: 更新对话标题，对话ID:\", conversationId, \"标题:\", title);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"PATCH\",\r\n        queryParams: {\r\n          id: `eq.${conversationId}`\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:406\", \"MCP: 更新对话标题成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:409\", \"MCP: 更新对话标题失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 删除对话（软删除，修复版本）\r\n  async deleteConversation(conversationId) {\r\n    try {\r\n      const data = {\r\n        is_active: false,\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:422\", \"MCP: 删除对话，对话ID:\", conversationId);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"PATCH\",\r\n        queryParams: {\r\n          id: `eq.${conversationId}`\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:432\", \"MCP: 删除对话成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:435\", \"MCP: 删除对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取对话统计信息（修复版本）\r\n  async getConversationStats() {\r\n    try {\r\n      const conversations = await this.getUserConversations();\r\n      const stats = {\r\n        total: conversations.length,\r\n        recent: conversations.filter((conv) => {\r\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\r\n          return new Date(conv.created_at) > oneWeekAgo;\r\n        }).length\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:453\", \"MCP: 获取统计信息成功:\", stats);\r\n      return stats;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:456\", \"MCP: 获取统计信息失败:\", error);\r\n      return { total: 0, recent: 0 };\r\n    }\r\n  }\r\n}\r\n\r\nclass ConversationService {\r\n  constructor() {\r\n    this.supabaseService = new SupabaseService();\r\n  }\r\n  // 检查Supabase连接\r\n  async checkSupabaseConnection() {\r\n    try {\r\n      const isConnected = this.supabaseService.isConnected;\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:560\", \"Supabase连接状态检查:\", { isConnected });\r\n      return isConnected;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:563\", \"Supabase连接检查失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 创建对话\r\n  async createConversation(title, roleId, styleId) {\r\n    try {\r\n      const result = await this.supabaseService.createConversation(title, roleId, styleId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:571\", \"创建对话成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:574\", \"创建对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取用户对话\r\n  async getUserConversations() {\r\n    try {\r\n      const result = await this.supabaseService.getUserConversations();\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:582\", \"获取用户对话成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:585\", \"获取用户对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 保存消息\r\n  async saveMessage(conversationId, role, content) {\r\n    try {\r\n      const result = await this.supabaseService.saveMessage(conversationId, role, content);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:593\", \"保存消息成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:596\", \"保存消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 更新对话标题\r\n  async updateConversationTitle(conversationId, title) {\r\n    try {\r\n      const result = await this.supabaseService.updateConversationTitle(conversationId, title);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:604\", \"更新对话标题成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:607\", \"更新对话标题失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 删除对话\r\n  async deleteConversation(conversationId) {\r\n    try {\r\n      const result = await this.supabaseService.deleteConversation(conversationId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:615\", \"删除对话成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:618\", \"删除对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取对话消息\r\n  async getConversationMessages(conversationId) {\r\n    try {\r\n      const result = await this.supabaseService.getConversationMessages(conversationId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:633\", \"获取对话消息成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:636\", \"获取对话消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // 获取统计信息\r\n  async getConversationStats() {\r\n    try {\r\n      const conversations = await this.getUserConversations();\r\n      const stats = {\r\n        total: conversations.length,\r\n        recent: conversations.filter((conv) => {\r\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\r\n          return new Date(conv.created_at) > oneWeekAgo;\r\n        }).length\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:653\", \"获取统计信息成功:\", stats);\r\n      return stats;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:656\", \"获取统计信息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\nconst conversationService = new ConversationService();\r\nexport default conversationService;\r\n//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/supabase.js.map\r\n"],"names":[],"mappings":"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"}