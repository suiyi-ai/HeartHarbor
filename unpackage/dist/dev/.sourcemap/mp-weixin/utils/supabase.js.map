{"version":3,"file":"supabase.js","sources":["utils/supabase.js"],"sourcesContent":["\"use strict\";\r\nconst common_vendor = require(\"../common/vendor.js\");\r\nconst SUPABASE_CONFIG = {\r\n  url: \"https://etvdmnsernfiegfeadad.supabase.co\",\r\n  anonKey: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0dmRtbnNlcm5maWVnZmVhZGFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NzM1MDUsImV4cCI6MjA3NzQ0OTUwNX0.FNvK-NrAxGrY5TwYblFC__hScR9lxjC5VFEUPlMYtTY\"\r\n};\r\nfunction generateUUID() {\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\r\n    const r = Math.random() * 16 | 0;\r\n    const v = c === \"x\" ? r : r & 3 | 8;\r\n    return v.toString(16);\r\n  });\r\n}\r\nfunction isValidUUID(uuid) {\r\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n  return uuidRegex.test(uuid);\r\n}\r\nfunction convertLegacyUserId(legacyId) {\r\n  if (isValidUUID(legacyId)) {\r\n    return legacyId;\r\n  }\r\n  const hash = legacyId.split(\"\").reduce((a, b) => {\r\n    a = (a << 5) - a + b.charCodeAt(0);\r\n    return a & a;\r\n  }, 0);\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\r\n    const r = (hash + Math.random() * 16) % 16 | 0;\r\n    const v = c === \"x\" ? r : r & 3 | 8;\r\n    return v.toString(16);\r\n  });\r\n}\r\nfunction getUserId() {\r\n  // 优先从登录用户信息中获取用户ID\r\n  try {\r\n    const currentUserStr = common_vendor.index.getStorageSync(\"current_user\");\r\n    if (currentUserStr) {\r\n      const currentUser = JSON.parse(currentUserStr);\r\n      if (currentUser && currentUser.id) {\r\n        common_vendor.index.__f__(\"log\", \"at utils/supabase.js:49\", \"使用登录用户ID:\", currentUser.id);\r\n        return currentUser.id;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:55\", \"获取登录用户信息失败:\", error);\r\n  }\r\n  \r\n  // 如果没有登录用户，使用本地存储的匿名用户ID\r\n  let userId = common_vendor.index.getStorageSync(\"user_id\");\r\n  if (!userId) {\r\n    userId = generateUUID();\r\n    common_vendor.index.setStorageSync(\"user_id\", userId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:61\", \"生成新匿名用户ID（UUID格式）:\", userId);\r\n  } else if (!isValidUUID(userId)) {\r\n    const newUserId = convertLegacyUserId(userId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:65\", \"转换旧用户ID格式:\", userId, \"->\", newUserId);\r\n    userId = newUserId;\r\n    common_vendor.index.setStorageSync(\"user_id\", userId);\r\n  }\r\n  return userId;\r\n}\r\nfunction buildSupabaseQuery(params) {\r\n  const parts = [];\r\n  Object.keys(params).forEach((key) => {\r\n    const value = params[key];\r\n    if (value !== null && value !== void 0) {\r\n      if (key === \"select\") {\r\n        parts.push(`select=${encodeURIComponent(value)}`);\r\n      } else if (key === \"order\") {\r\n        parts.push(`order=${encodeURIComponent(value)}`);\r\n      } else {\r\n        parts.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\r\n      }\r\n    }\r\n  });\r\n  return parts.join(\"&\");\r\n}\r\nfunction handleSupabaseError(response, url, options) {\r\n  let errorMessage = `API Error: ${response.statusCode}`;\r\n  if (response.data) {\r\n    if (response.data.message) {\r\n      errorMessage += ` - ${response.data.message}`;\r\n      if (response.data.message.includes(\"invalid input syntax for type uuid\")) {\r\n        errorMessage += \" (用户ID格式错误，已自动修复)\";\r\n        const oldUserId = common_vendor.index.getStorageSync(\"user_id\");\r\n        const newUserId = generateUUID();\r\n        common_vendor.index.setStorageSync(\"user_id\", newUserId);\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:100\", \"检测到UUID格式错误，已重新生成用户ID:\", {\r\n          oldUserId,\r\n          newUserId\r\n        });\r\n      }\r\n    }\r\n    if (response.data.hint) {\r\n      errorMessage += ` (${response.data.hint})`;\r\n    }\r\n    if (response.data.details) {\r\n      errorMessage += ` [${response.data.details}]`;\r\n    }\r\n  }\r\n  common_vendor.index.__f__(\"error\", \"at utils/supabase.js:114\", \"Supabase API错误详情:\", {\r\n    url,\r\n    method: options.method,\r\n    statusCode: response.statusCode,\r\n    error: errorMessage,\r\n    responseData: response.data\r\n  });\r\n  return new Error(errorMessage);\r\n}\r\nasync function migrateUserData() {\r\n  const oldUserId = common_vendor.index.getStorageSync(\"user_id_legacy\");\r\n  const currentUserId = common_vendor.index.getStorageSync(\"user_id\");\r\n  if (!oldUserId && currentUserId && !isValidUUID(currentUserId)) {\r\n    common_vendor.index.setStorageSync(\"user_id_legacy\", currentUserId);\r\n    const newUserId = generateUUID();\r\n    common_vendor.index.setStorageSync(\"user_id\", newUserId);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:138\", \"执行用户数据迁移:\", {\r\n      oldUserId: currentUserId,\r\n      newUserId\r\n    });\r\n    return newUserId;\r\n  }\r\n  return currentUserId;\r\n}\r\nclass SupabaseService {\r\n  constructor() {\r\n    // 不在构造函数中设置 userId，改为动态获取\r\n    this.isConnected = false;\r\n    this.initConnection();\r\n  }\r\n  \r\n  // 获取当前用户ID（支持动态获取，优先使用登录用户ID）\r\n  getUserId() {\r\n    // 优先从登录用户信息中获取用户ID\r\n    try {\r\n      const currentUserStr = common_vendor.index.getStorageSync(\"current_user\");\r\n      if (currentUserStr) {\r\n        const currentUser = JSON.parse(currentUserStr);\r\n        if (currentUser && currentUser.id) {\r\n          common_vendor.index.__f__(\"log\", \"at utils/supabase.js:139\", \"使用登录用户ID:\", currentUser.id);\r\n          return currentUser.id;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:147\", \"获取登录用户信息失败:\", error);\r\n    }\r\n    \r\n    // 如果没有登录用户，使用本地存储的匿名用户ID\r\n    let userId = common_vendor.index.getStorageSync(\"user_id\");\r\n    if (!userId) {\r\n      userId = generateUUID();\r\n      common_vendor.index.setStorageSync(\"user_id\", userId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:155\", \"生成新匿名用户ID（UUID格式）:\", userId);\r\n    } else if (!isValidUUID(userId)) {\r\n      const newUserId = convertLegacyUserId(userId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:159\", \"转换旧用户ID格式:\", userId, \"->\", newUserId);\r\n      userId = newUserId;\r\n      common_vendor.index.setStorageSync(\"user_id\", userId);\r\n    }\r\n    return userId;\r\n  }\r\n  \r\n  // 初始化连接（修复版本）\r\n  async initConnection() {\r\n    try {\r\n      await migrateUserData();\r\n      // 验证用户ID格式\r\n      const userId = this.getUserId();\r\n      if (!isValidUUID(userId)) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:171\", \"用户ID格式无效，重新生成:\", userId);\r\n        const newUserId = generateUUID();\r\n        common_vendor.index.setStorageSync(\"user_id\", newUserId);\r\n      }\r\n      \r\n      // 直接测试连接，不依赖isConnected状态\r\n      const testResult = await this.testConnection();\r\n      this.isConnected = true;\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:178\", \"Supabase MCP连接成功，用户ID:\", this.getUserId());\r\n      return testResult;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:174\", \"Supabase MCP连接失败，将使用降级方案:\", error);\r\n      this.isConnected = false;\r\n      throw error;\r\n    }\r\n  }\r\n  // 测试连接（修复版本）\r\n  async testConnection() {\r\n    const url = `${SUPABASE_CONFIG.url}/rest/v1/conversations?limit=1`;\r\n    const options = {\r\n      method: \"GET\",\r\n      header: {\r\n        \"apikey\": SUPABASE_CONFIG.anonKey,\r\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      timeout: 10e3\r\n    };\r\n    \r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:175\", \"测试Supabase连接:\", url);\r\n    \r\n    try {\r\n      const response = await common_vendor.index.request({\r\n        url,\r\n        ...options\r\n      });\r\n      \r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:183\", \"连接测试响应状态码:\", response.statusCode);\r\n      \r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return response.data;\r\n      } else {\r\n        throw handleSupabaseError(response, url, options);\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:191\", \"Supabase连接测试失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // API调用方法\r\n  async callApi(endpoint, options = {}) {\r\n    if (!this.isConnected) {\r\n      throw new Error(\"Supabase连接不可用，请检查网络连接\");\r\n    }\r\n    let url = `${SUPABASE_CONFIG.url}/rest/v1/${endpoint}`;\r\n    const defaultOptions = {\r\n      method: \"GET\",\r\n      header: {\r\n        \"apikey\": SUPABASE_CONFIG.anonKey,\r\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\r\n        \"Content-Type\": \"application/json\",\r\n        \"Prefer\": \"return=representation\"\r\n      },\r\n      timeout: 15e3\r\n    };\r\n    if (options.queryParams) {\r\n      const queryString = buildSupabaseQuery(options.queryParams);\r\n      if (queryString) {\r\n        url += \"?\" + queryString;\r\n      }\r\n    }\r\n    const finalOptions = {\r\n      ...defaultOptions,\r\n      ...options,\r\n      url,\r\n      header: {\r\n        ...defaultOptions.header,\r\n        ...options.header || {}\r\n      }\r\n    };\r\n    if ((options.method === \"POST\" || options.method === \"PATCH\") && options.data) {\r\n      finalOptions.data = JSON.stringify(options.data);\r\n    }\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:236\", `MCP API调用: ${finalOptions.method} ${url}`);\r\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:237\", \"查询参数:\", options.queryParams);\r\n    try {\r\n      const response = await common_vendor.index.request(finalOptions);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:242\", \"API响应状态码:\", response.statusCode);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:243\", \"API响应数据:\", response.data);\r\n      if (response.statusCode >= 200 && response.statusCode < 300) {\r\n        return response.data;\r\n      } else {\r\n        throw handleSupabaseError(response, url, options);\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:251\", \"Supabase API调用失败:\", error);\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:252\", \"请求详情:\", {\r\n        url,\r\n        method: finalOptions.method,\r\n        headers: finalOptions.header\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n  // 创建新对话（修复版本）\r\n  async createConversation(title, roleId, styleId) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      \r\n      // 确保 styleId 不为 null 或 undefined\r\n      // 如果没有提供，使用默认值 'friendly'\r\n      const finalStyleId = styleId || 'friendly';\r\n      \r\n      const data = {\r\n        user_id: userId,\r\n        title: title || \"新对话\",\r\n        role_id: roleId,\r\n        style_id: finalStyleId, // 确保不为 null\r\n        is_active: true,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString(),\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:274\", \"MCP: 创建对话，用户ID:\", userId, \"数据:\", data);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:285\", \"MCP: 创建对话成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:288\", \"MCP: 创建对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取用户的所有对话（修复HTTP 400错误）\r\n  async getUserConversations() {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:296\", \"MCP: 获取用户对话，用户ID:\", userId);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          user_id: `eq.${userId}`,\r\n          is_active: \"eq.true\",\r\n          select: \"*\"\r\n        }\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:307\", \"MCP: 获取对话成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:310\", \"MCP: 获取用户对话失败:\", error);\r\n      return [];\r\n    }\r\n  }\r\n  // 获取对话的详细信息（修复版本，支持用户验证）\r\n  async getConversation(conversationId, verifyUser = false) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:319\", \"MCP: 获取对话详情，对话ID:\", conversationId, \"用户ID:\", userId);\r\n      \r\n      // 构建查询参数\r\n      const queryParams = {\r\n        id: `eq.${conversationId}`,\r\n        select: \"*\"\r\n      };\r\n      \r\n      // 如果需要验证用户，添加用户ID过滤\r\n      if (verifyUser) {\r\n        queryParams.user_id = `eq.${userId}`;\r\n      }\r\n      \r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"GET\",\r\n        queryParams: queryParams\r\n      });\r\n      \r\n      const conversation = result ? result[0] : null;\r\n      \r\n      // 如果找到了对话，验证用户所有权\r\n      if (conversation && verifyUser && conversation.user_id !== userId) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:340\", \"MCP: 对话不属于当前用户，对话ID:\", conversationId);\r\n        return null;\r\n      }\r\n      \r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:345\", \"MCP: 获取对话详情成功:\", conversation);\r\n      return conversation;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:348\", \"MCP: 获取对话详情失败:\", error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  // 获取对话的所有消息（修复版本）\r\n  async getConversationMessages(conversationId) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      \r\n      // 首先验证对话属于当前用户\r\n      const conversation = await this.getConversation(conversationId, true);\r\n      if (!conversation) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:361\", \"MCP: 对话不存在或不属于当前用户，对话ID:\", conversationId);\r\n        return [];\r\n      }\r\n      \r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:365\", \"MCP: 获取对话消息，对话ID:\", conversationId, \"用户ID:\", userId);\r\n      const result = await this.callApi(\"messages\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          conversation_id: `eq.${conversationId}`,\r\n          order: \"created_at.asc\",\r\n          select: \"*\"\r\n        }\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:376\", \"MCP: 获取消息成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:379\", \"MCP: 获取对话消息失败:\", error);\r\n      return [];\r\n    }\r\n  }\r\n  // 保存消息（修复版本）\r\n  async saveMessage(conversationId, role, content) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      \r\n      // 首先验证对话属于当前用户\r\n      const conversation = await this.getConversation(conversationId, true);\r\n      if (!conversation) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:391\", \"MCP: 对话不存在或不属于当前用户，无法保存消息，对话ID:\", conversationId);\r\n        throw new Error(\"对话不存在或不属于当前用户\");\r\n      }\r\n      \r\n      const data = {\r\n        conversation_id: conversationId,\r\n        role,\r\n        content,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:400\", \"MCP: 保存消息，用户ID:\", userId, \"数据:\", data);\r\n      const result = await this.callApi(\"messages\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:411\", \"MCP: 保存消息成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:414\", \"MCP: 保存消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 更新对话标题（修复版本）\r\n  async updateConversationTitle(conversationId, title) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      \r\n      // 首先验证对话属于当前用户\r\n      const conversation = await this.getConversation(conversationId, true);\r\n      if (!conversation) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:424\", \"MCP: 对话不存在或不属于当前用户，无法更新标题，对话ID:\", conversationId);\r\n        throw new Error(\"对话不存在或不属于当前用户\");\r\n      }\r\n      \r\n      const data = {\r\n        title,\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:432\", \"MCP: 更新对话标题，用户ID:\", userId, \"对话ID:\", conversationId, \"标题:\", title);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"PATCH\",\r\n        queryParams: {\r\n          id: `eq.${conversationId}`,\r\n          user_id: `eq.${userId}` // 确保只更新当前用户的对话\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:442\", \"MCP: 更新对话标题成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:445\", \"MCP: 更新对话标题失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 删除对话（软删除，修复版本）\r\n  async deleteConversation(conversationId) {\r\n    try {\r\n      // 确保使用最新的用户ID（支持用户登录后动态更新）\r\n      const userId = this.getUserId();\r\n      \r\n      // 首先验证对话属于当前用户\r\n      const conversation = await this.getConversation(conversationId, true);\r\n      if (!conversation) {\r\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:456\", \"MCP: 对话不存在或不属于当前用户，无法删除，对话ID:\", conversationId);\r\n        throw new Error(\"对话不存在或不属于当前用户\");\r\n      }\r\n      \r\n      const data = {\r\n        is_active: false,\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:464\", \"MCP: 删除对话，用户ID:\", userId, \"对话ID:\", conversationId);\r\n      const result = await this.callApi(\"conversations\", {\r\n        method: \"PATCH\",\r\n        queryParams: {\r\n          id: `eq.${conversationId}`,\r\n          user_id: `eq.${userId}` // 确保只删除当前用户的对话\r\n        },\r\n        data\r\n      });\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:474\", \"MCP: 删除对话成功:\", result);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:477\", \"MCP: 删除对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取对话统计信息（修复版本）\r\n  async getConversationStats() {\r\n    try {\r\n      const conversations = await this.getUserConversations();\r\n      const stats = {\r\n        total: conversations.length,\r\n        recent: conversations.filter((conv) => {\r\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\r\n          return new Date(conv.created_at) > oneWeekAgo;\r\n        }).length\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:453\", \"MCP: 获取统计信息成功:\", stats);\r\n      return stats;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:456\", \"MCP: 获取统计信息失败:\", error);\r\n      return { total: 0, recent: 0 };\r\n    }\r\n  }\r\n  \r\n  // ========== 树洞功能相关方法 ==========\r\n  \r\n  // 创建树洞帖子\r\n  async createTreeholePost(content, emotion = 'neutral', isAnonymous = true) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const data = {\r\n        user_id: userId,\r\n        content: content,\r\n        emotion: emotion,\r\n        is_anonymous: isAnonymous,\r\n        like_count: 0,\r\n        comment_count: 0,\r\n        is_active: true,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString(),\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:525\", \"MCP: 创建树洞帖子\");\r\n      const result = await this.callApi(\"treehole_posts\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:540\", \"MCP: 创建树洞帖子失败:\", error);\r\n      if (error.message && error.message.includes('does not exist')) {\r\n        return null;\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取树洞帖子列表（分页）\r\n  async getTreeholePosts(page = 1, limit = 20) {\r\n    try {\r\n      const offset = (page - 1) * limit;\r\n      const result = await this.callApi(\"treehole_posts\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          is_active: \"eq.true\",\r\n          order: \"created_at.desc\",\r\n          limit: `${limit}`,\r\n          offset: `${offset}`,\r\n          select: \"*\"\r\n        }\r\n      });\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:562\", \"MCP: 获取树洞帖子列表失败:\", error);\r\n      if (error.message && error.message.includes('does not exist')) {\r\n        return [];\r\n      }\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  // 点赞树洞帖子\r\n  async likeTreeholePost(postId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const existingLike = await this.callApi(\"treehole_likes\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          post_id: `eq.${postId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: \"*\"\r\n        }\r\n      });\r\n      \r\n      if (existingLike && existingLike.length > 0) {\r\n        await this.callApi(\"treehole_likes\", {\r\n          method: \"DELETE\",\r\n          queryParams: {\r\n            post_id: `eq.${postId}`,\r\n            user_id: `eq.${userId}`\r\n          }\r\n        });\r\n        await this.updateTreeholePostLikeCount(postId, -1);\r\n        return { liked: false };\r\n      } else {\r\n        await this.callApi(\"treehole_likes\", {\r\n          method: \"POST\",\r\n          header: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Prefer\": \"return=representation\"\r\n          },\r\n          data: {\r\n            post_id: postId,\r\n            user_id: userId,\r\n            created_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n        await this.updateTreeholePostLikeCount(postId, 1);\r\n        return { liked: true };\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:603\", \"MCP: 点赞树洞帖子失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 更新树洞帖子点赞数\r\n  async updateTreeholePostLikeCount(postId, delta) {\r\n    try {\r\n      const post = await this.callApi(\"treehole_posts\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${postId}`,\r\n          select: \"like_count\"\r\n        }\r\n      });\r\n      \r\n      if (post && post.length > 0) {\r\n        const newLikeCount = Math.max(0, (post[0].like_count || 0) + delta);\r\n        await this.callApi(\"treehole_posts\", {\r\n          method: \"PATCH\",\r\n          queryParams: {\r\n            id: `eq.${postId}`\r\n          },\r\n          data: {\r\n            like_count: newLikeCount,\r\n            updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:631\", \"MCP: 更新树洞帖子点赞数失败:\", error);\r\n    }\r\n  }\r\n  \r\n  // 检查用户是否已点赞某个帖子\r\n  async checkUserLikedPost(postId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const result = await this.callApi(\"treehole_likes\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          post_id: `eq.${postId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: \"*\"\r\n        }\r\n      });\r\n      return result && result.length > 0;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  // 获取树洞帖子的评论列表\r\n  async getTreeholeComments(postId) {\r\n    try {\r\n      const result = await this.callApi(\"treehole_comments\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          post_id: `eq.${postId}`,\r\n          order: \"created_at.asc\",\r\n          select: \"*\"\r\n        }\r\n      });\r\n      return result || [];\r\n    } catch (error) {\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  // 添加树洞评论\r\n  async addTreeholeComment(postId, content, isAnonymous = true) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const data = {\r\n        post_id: postId,\r\n        user_id: userId,\r\n        content: content,\r\n        is_anonymous: isAnonymous,\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      const result = await this.callApi(\"treehole_comments\", {\r\n        method: \"POST\",\r\n        header: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Prefer\": \"return=representation\"\r\n        },\r\n        data\r\n      });\r\n      \r\n      await this.updateTreeholePostCommentCount(postId, 1);\r\n      return result ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:685\", \"MCP: 添加树洞评论失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 删除树洞帖子\r\n  async deleteTreeholePost(postId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      \r\n      // 先检查帖子是否存在且属于当前用户\r\n      const post = await this.callApi(\"treehole_posts\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${postId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: \"id\"\r\n        }\r\n      });\r\n      \r\n      if (!post || post.length === 0) {\r\n        throw new Error(\"帖子不存在或无权删除\");\r\n      }\r\n      \r\n      // 删除帖子（级联删除会自动删除相关的点赞和评论）\r\n      await this.callApi(\"treehole_posts\", {\r\n        method: \"DELETE\",\r\n        queryParams: {\r\n          id: `eq.${postId}`,\r\n          user_id: `eq.${userId}`\r\n        }\r\n      });\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:750\", \"MCP: 删除树洞帖子失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 更新树洞帖子评论数\r\n  async updateTreeholePostCommentCount(postId, delta) {\r\n    try {\r\n      const post = await this.callApi(\"treehole_posts\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${postId}`,\r\n          select: \"comment_count\"\r\n        }\r\n      });\r\n      \r\n      if (post && post.length > 0) {\r\n        const newCommentCount = Math.max(0, (post[0].comment_count || 0) + delta);\r\n        await this.callApi(\"treehole_posts\", {\r\n          method: \"PATCH\",\r\n          queryParams: {\r\n            id: `eq.${postId}`\r\n          },\r\n          data: {\r\n            comment_count: newCommentCount,\r\n            updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:715\", \"MCP: 更新树洞帖子评论数失败:\", error);\r\n    }\r\n  }\r\n  \r\n  // ============================================\r\n  // 心理库文章相关方法\r\n  // ============================================\r\n  \r\n  // 获取文章列表\r\n  async getArticles(params = {}) {\r\n    try {\r\n      const {\r\n        page = 1,\r\n        limit = 20,\r\n        category = null,\r\n        isHot = null,\r\n        isNew = null,\r\n        search = null,\r\n        orderBy = 'created_at',\r\n        order = 'desc'\r\n      } = params;\r\n      \r\n      const queryParams = {\r\n        is_active: 'eq.true',\r\n        select: '*',\r\n        order: `${orderBy}.${order}`,\r\n        limit: limit.toString(),\r\n        offset: ((page - 1) * limit).toString()\r\n      };\r\n      \r\n      // 按分类筛选\r\n      if (category && category !== 'all') {\r\n        queryParams.category_name = `eq.${category}`;\r\n      }\r\n      \r\n      // 按热门筛选\r\n      if (isHot !== null) {\r\n        queryParams.is_hot = `eq.${isHot}`;\r\n      }\r\n      \r\n      // 按新文章筛选\r\n      if (isNew !== null) {\r\n        queryParams.is_new = `eq.${isNew}`;\r\n      }\r\n      \r\n      // 按搜索关键词筛选\r\n      // 注意：Supabase REST API 不支持直接在 URL 中使用 or 查询\r\n      // 如果需要多字段搜索，需要使用 PostgreSQL 的函数或在前端过滤\r\n      // 这里我们使用 title 作为主要搜索字段\r\n      // 更复杂的搜索可以通过 RPC 函数实现\r\n      if (search && search.trim()) {\r\n        // 使用 title 字段进行搜索\r\n        queryParams.title = `ilike.%${search.trim()}%`;\r\n      }\r\n      \r\n      const articles = await this.callApi(\"articles\", {\r\n        method: \"GET\",\r\n        queryParams\r\n      });\r\n      \r\n      // 转换数据格式，适配前端\r\n      return articles.map(article => ({\r\n        id: article.id,\r\n        title: article.title,\r\n        category: article.category_name || article.category,\r\n        summary: article.summary,\r\n        content: article.content,\r\n        readTime: article.read_time || 5,\r\n        viewCount: article.view_count || 0,\r\n        likeCount: article.like_count || 0,\r\n        favoriteCount: article.favorite_count || 0,\r\n        date: article.published_at || article.created_at,\r\n        isHot: article.is_hot || false,\r\n        isNew: article.is_new || false,\r\n        isFeatured: article.is_featured || false,\r\n        isFavorited: false, // 需要单独查询收藏状态\r\n        authorName: article.author_name,\r\n        coverImageUrl: article.cover_image_url,\r\n        tags: article.tags || []\r\n      }));\r\n    } catch (error) {\r\n      // 如果是表不存在的错误，给出明确的提示\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        const errorMsg = '数据库表不存在，请先在Supabase中执行 scripts/create_library_tables_improved.sql 创建表结构';\r\n        common_vendor.index.__f__(\"error\", \"at utils/supabase.js:853\", errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:853\", \"MCP: 获取文章列表失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取文章详情\r\n  async getArticleById(articleId) {\r\n    try {\r\n      const articles = await this.callApi(\"articles\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${articleId}`,\r\n          is_active: 'eq.true',\r\n          select: '*'\r\n        }\r\n      });\r\n      \r\n      if (!articles || articles.length === 0) {\r\n        throw new Error(\"文章不存在\");\r\n      }\r\n      \r\n      const article = articles[0];\r\n      \r\n      // 转换数据格式\r\n      return {\r\n        id: article.id,\r\n        title: article.title,\r\n        category: article.category_name || article.category,\r\n        summary: article.summary,\r\n        content: article.content,\r\n        readTime: article.read_time || 5,\r\n        viewCount: article.view_count || 0,\r\n        likeCount: article.like_count || 0,\r\n        favoriteCount: article.favorite_count || 0,\r\n        date: article.published_at || article.created_at,\r\n        isHot: article.is_hot || false,\r\n        isNew: article.is_new || false,\r\n        isFeatured: article.is_featured || false,\r\n        isFavorited: false, // 需要单独查询收藏状态\r\n        authorName: article.author_name,\r\n        coverImageUrl: article.cover_image_url,\r\n        tags: article.tags || [],\r\n        seoKeywords: article.seo_keywords,\r\n        seoDescription: article.seo_description\r\n      };\r\n    } catch (error) {\r\n      // 如果是表不存在的错误，给出明确的提示\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        const errorMsg = '数据库表不存在，请先在Supabase中执行 scripts/create_library_tables_improved.sql 创建表结构';\r\n        common_vendor.index.__f__(\"error\", \"at utils/supabase.js:903\", errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:903\", \"MCP: 获取文章详情失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 检查用户是否收藏了文章\r\n  async checkUserFavoriteArticle(articleId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const favorites = await this.callApi(\"article_favorites\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          article_id: `eq.${articleId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: 'id'\r\n        }\r\n      });\r\n      \r\n      return favorites && favorites.length > 0;\r\n    } catch (error) {\r\n      // 如果是表不存在的错误，抛出明确的错误\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        const errorMsg = '数据库表 article_favorites 不存在，请先在Supabase中执行 scripts/create_library_tables.sql 创建表结构';\r\n        common_vendor.index.__f__(\"error\", \"at utils/supabase.js:902\", errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n      // 其他错误才记录\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:902\", \"MCP: 检查收藏状态失败:\", error);\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  // 切换文章收藏状态\r\n  async toggleArticleFavorite(articleId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const isFavorited = await this.checkUserFavoriteArticle(articleId);\r\n      \r\n      if (isFavorited) {\r\n        // 取消收藏\r\n        await this.callApi(\"article_favorites\", {\r\n          method: \"DELETE\",\r\n          queryParams: {\r\n            article_id: `eq.${articleId}`,\r\n            user_id: `eq.${userId}`\r\n          }\r\n        });\r\n        return { favorited: false };\r\n      } else {\r\n        // 添加收藏\r\n        await this.callApi(\"article_favorites\", {\r\n          method: \"POST\",\r\n          data: {\r\n            article_id: articleId,\r\n            user_id: userId\r\n          }\r\n        });\r\n        return { favorited: true };\r\n      }\r\n    } catch (error) {\r\n      // 如果是表不存在的错误，给出明确的提示\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        const errorMsg = '数据库表 article_favorites 不存在，请先在Supabase中执行 scripts/create_library_tables.sql 创建表结构';\r\n        common_vendor.index.__f__(\"error\", \"at utils/supabase.js:928\", errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:928\", \"MCP: 切换收藏状态失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 保存阅读历史\r\n  async saveArticleReadHistory(articleId, readProgress = 100, readDuration = 0) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      \r\n      // 先检查是否已存在阅读历史\r\n      const existingHistory = await this.callApi(\"article_read_history\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          article_id: `eq.${articleId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: 'id,read_progress,read_duration'\r\n        }\r\n      });\r\n      \r\n      if (existingHistory && existingHistory.length > 0) {\r\n        // 更新现有记录\r\n        await this.callApi(\"article_read_history\", {\r\n          method: \"PATCH\",\r\n          queryParams: {\r\n            article_id: `eq.${articleId}`,\r\n            user_id: `eq.${userId}`\r\n          },\r\n          data: {\r\n            read_progress: readProgress,\r\n            read_duration: (existingHistory[0].read_duration || 0) + readDuration,\r\n            last_read_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n      } else {\r\n        // 创建新记录\r\n        await this.callApi(\"article_read_history\", {\r\n          method: \"POST\",\r\n          data: {\r\n            article_id: articleId,\r\n            user_id: userId,\r\n            read_progress: readProgress,\r\n            read_duration: readDuration,\r\n            last_read_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n      }\r\n      \r\n      // 增加文章浏览数\r\n      await this.increaseArticleViewCount(articleId);\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      // 如果是表不存在的错误，给出明确的提示\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        const errorMsg = '数据库表 article_read_history 不存在，请先在Supabase中执行 scripts/create_library_tables.sql 创建表结构';\r\n        common_vendor.index.__f__(\"error\", \"at utils/supabase.js:955\", errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:955\", \"MCP: 保存阅读历史失败:\", error);\r\n      // 不抛出错误，阅读历史保存失败不影响主流程\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  // 增加文章浏览数\r\n  async increaseArticleViewCount(articleId) {\r\n    try {\r\n      // 先获取当前浏览数\r\n      const articles = await this.callApi(\"articles\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${articleId}`,\r\n          select: \"view_count\"\r\n        }\r\n      });\r\n      \r\n      if (articles && articles.length > 0) {\r\n        const newViewCount = (articles[0].view_count || 0) + 1;\r\n        await this.callApi(\"articles\", {\r\n          method: \"PATCH\",\r\n          queryParams: {\r\n            id: `eq.${articleId}`\r\n          },\r\n          data: {\r\n            view_count: newViewCount,\r\n            updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:940\", \"MCP: 增加浏览数失败:\", error);\r\n      // 不抛出错误，浏览数增加失败不影响主流程\r\n    }\r\n  }\r\n  \r\n  // 获取用户收藏的文章列表\r\n  async getUserFavoriteArticles(page = 1, limit = 20) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const favorites = await this.callApi(\"article_favorites\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          user_id: `eq.${userId}`,\r\n          select: 'article_id,created_at,articles(*)',\r\n          order: 'created_at.desc',\r\n          limit: limit.toString(),\r\n          offset: ((page - 1) * limit).toString()\r\n        }\r\n      });\r\n      \r\n      // 提取文章数据并转换格式\r\n      return favorites.map(fav => {\r\n        const article = fav.articles;\r\n        if (!article || !article.is_active) return null;\r\n        \r\n        return {\r\n          id: article.id,\r\n          title: article.title,\r\n          category: article.category_name || article.category,\r\n          summary: article.summary,\r\n          content: article.content,\r\n          readTime: article.read_time || 5,\r\n          viewCount: article.view_count || 0,\r\n          likeCount: article.like_count || 0,\r\n          favoriteCount: article.favorite_count || 0,\r\n          date: article.published_at || article.created_at,\r\n          isHot: article.is_hot || false,\r\n          isNew: article.is_new || false,\r\n          isFeatured: article.is_featured || false,\r\n          isFavorited: true,\r\n          authorName: article.author_name,\r\n          coverImageUrl: article.cover_image_url,\r\n          tags: article.tags || [],\r\n          favoritedAt: fav.created_at\r\n        };\r\n      }).filter(article => article !== null);\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:990\", \"MCP: 获取收藏文章失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取用户统计数据\r\n  async getUserStats() {\r\n    try {\r\n      const userId = this.getUserId();\r\n      \r\n      // 并行获取各项统计数据\r\n      const [treeholeCount, favoriteCount, readHistoryCount, conversationCount, moodRecordCount] = await Promise.all([\r\n        // 树洞帖子数\r\n        this.callApi(\"treehole_posts\", {\r\n          method: \"GET\",\r\n          queryParams: {\r\n            user_id: `eq.${userId}`,\r\n            is_active: 'eq.true',\r\n            select: 'id'\r\n          }\r\n        }).then(result => result ? result.length : 0).catch(() => 0),\r\n        \r\n        // 收藏文章数\r\n        this.callApi(\"article_favorites\", {\r\n          method: \"GET\",\r\n          queryParams: {\r\n            user_id: `eq.${userId}`,\r\n            select: 'id'\r\n          }\r\n        }).then(result => result ? result.length : 0).catch(() => 0),\r\n        \r\n        // 阅读历史数\r\n        this.callApi(\"article_read_history\", {\r\n          method: \"GET\",\r\n          queryParams: {\r\n            user_id: `eq.${userId}`,\r\n            select: 'id'\r\n          }\r\n        }).then(result => result ? result.length : 0).catch(() => 0),\r\n        \r\n        // 对话数\r\n        this.getUserConversations().then(conversations => conversations ? conversations.length : 0).catch(() => 0),\r\n        \r\n        // 心情记录数\r\n        this.callApi(\"mood_records\", {\r\n          method: \"GET\",\r\n          queryParams: {\r\n            user_id: `eq.${userId}`,\r\n            select: 'id'\r\n          }\r\n        }).then(result => result ? result.length : 0).catch(() => 0)\r\n      ]);\r\n      \r\n      return {\r\n        treeholeCount,\r\n        favoriteCount,\r\n        readHistoryCount,\r\n        conversationCount,\r\n        moodRecordCount\r\n      };\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:1122\", \"MCP: 获取用户统计失败:\", error);\r\n      return {\r\n        treeholeCount: 0,\r\n        favoriteCount: 0,\r\n        readHistoryCount: 0,\r\n        conversationCount: 0,\r\n        moodRecordCount: 0\r\n      };\r\n    }\r\n  }\r\n  \r\n  // ============================================\r\n  // 心情记录相关方法\r\n  // ============================================\r\n  \r\n  // 创建心情记录\r\n  async createMoodRecord(moodData) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const data = {\r\n        user_id: userId,\r\n        mood_type: moodData.moodType || 'neutral',\r\n        mood_score: moodData.moodScore || 5,\r\n        note: moodData.note || null,\r\n        weather: moodData.weather || null,\r\n        location: moodData.location || null,\r\n        tags: moodData.tags || [],\r\n        created_at: (/* @__PURE__ */ new Date()).toISOString(),\r\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\r\n      };\r\n      \r\n      const result = await this.callApi(\"mood_records\", {\r\n        method: \"POST\",\r\n        data: data\r\n      });\r\n      \r\n      return result && result.length > 0 ? result[0] : null;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1200\", \"MCP: 创建心情记录失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取用户心情记录列表\r\n  async getUserMoodRecords(page = 1, limit = 20, startDate = null, endDate = null) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const queryParams = {\r\n        user_id: `eq.${userId}`,\r\n        order: 'created_at.desc',\r\n        limit: limit.toString(),\r\n        offset: ((page - 1) * limit).toString(),\r\n        select: '*'\r\n      };\r\n      \r\n      // 如果提供了日期范围，添加日期过滤\r\n      if (startDate) {\r\n        queryParams.created_at = `gte.${startDate}`;\r\n      }\r\n      if (endDate) {\r\n        queryParams.created_at = queryParams.created_at \r\n          ? `${queryParams.created_at},lte.${endDate}`\r\n          : `lte.${endDate}`;\r\n      }\r\n      \r\n      const result = await this.callApi(\"mood_records\", {\r\n        method: \"GET\",\r\n        queryParams: queryParams\r\n      });\r\n      \r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1230\", \"MCP: 获取心情记录失败:\", error);\r\n      // 如果表不存在，返回空数组\r\n      if (error.message && error.message.includes('Could not find the table')) {\r\n        return [];\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 删除心情记录\r\n  async deleteMoodRecord(recordId) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      \r\n      // 先检查记录是否属于当前用户\r\n      const records = await this.callApi(\"mood_records\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          id: `eq.${recordId}`,\r\n          user_id: `eq.${userId}`,\r\n          select: 'id'\r\n        }\r\n      });\r\n      \r\n      if (!records || records.length === 0) {\r\n        throw new Error(\"记录不存在或无权限删除\");\r\n      }\r\n      \r\n      await this.callApi(\"mood_records\", {\r\n        method: \"DELETE\",\r\n        queryParams: {\r\n          id: `eq.${recordId}`\r\n        }\r\n      });\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1260\", \"MCP: 删除心情记录失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取心情统计\r\n  async getMoodStats(startDate = null, endDate = null) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const queryParams = {\r\n        user_id: `eq.${userId}`,\r\n        select: 'mood_type,mood_score,created_at'\r\n      };\r\n      \r\n      if (startDate) {\r\n        queryParams.created_at = `gte.${startDate}`;\r\n      }\r\n      if (endDate) {\r\n        queryParams.created_at = queryParams.created_at \r\n          ? `${queryParams.created_at},lte.${endDate}`\r\n          : `lte.${endDate}`;\r\n      }\r\n      \r\n      const records = await this.callApi(\"mood_records\", {\r\n        method: \"GET\",\r\n        queryParams: queryParams\r\n      });\r\n      \r\n      if (!records || records.length === 0) {\r\n        return {\r\n          total: 0,\r\n          averageScore: 5,\r\n          moodDistribution: {},\r\n          recentMood: null\r\n        };\r\n      }\r\n      \r\n      // 计算统计数据\r\n      const moodDistribution = {};\r\n      let totalScore = 0;\r\n      let count = 0;\r\n      \r\n      records.forEach(record => {\r\n        const moodType = record.mood_type || 'neutral';\r\n        moodDistribution[moodType] = (moodDistribution[moodType] || 0) + 1;\r\n        if (record.mood_score) {\r\n          totalScore += record.mood_score;\r\n          count++;\r\n        }\r\n      });\r\n      \r\n      return {\r\n        total: records.length,\r\n        averageScore: count > 0 ? Math.round((totalScore / count) * 10) / 10 : 5,\r\n        moodDistribution: moodDistribution,\r\n        recentMood: records.length > 0 ? records[0] : null\r\n      };\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:1305\", \"MCP: 获取心情统计失败:\", error);\r\n      return {\r\n        total: 0,\r\n        averageScore: 5,\r\n        moodDistribution: {},\r\n        recentMood: null\r\n      };\r\n    }\r\n  }\r\n  \r\n  // 获取用户阅读历史\r\n  async getUserReadHistory(page = 1, limit = 20) {\r\n    try {\r\n      const userId = this.getUserId();\r\n      const history = await this.callApi(\"article_read_history\", {\r\n        method: \"GET\",\r\n        queryParams: {\r\n          user_id: `eq.${userId}`,\r\n          select: 'article_id,read_progress,read_duration,last_read_at,created_at,articles(*)',\r\n          order: 'last_read_at.desc',\r\n          limit: limit.toString(),\r\n          offset: ((page - 1) * limit).toString()\r\n        }\r\n      });\r\n      \r\n      // 提取文章数据并转换格式\r\n      return history.map(h => {\r\n        const article = h.articles;\r\n        if (!article || !article.is_active) return null;\r\n        \r\n        return {\r\n          id: article.id,\r\n          title: article.title,\r\n          category: article.category_name || article.category,\r\n          summary: article.summary,\r\n          content: article.content,\r\n          readTime: article.read_time || 5,\r\n          viewCount: article.view_count || 0,\r\n          likeCount: article.like_count || 0,\r\n          favoriteCount: article.favorite_count || 0,\r\n          date: article.published_at || article.created_at,\r\n          isHot: article.is_hot || false,\r\n          isNew: article.is_new || false,\r\n          isFeatured: article.is_featured || false,\r\n          isFavorited: false, // 需要单独查询\r\n          authorName: article.author_name,\r\n          coverImageUrl: article.cover_image_url,\r\n          tags: article.tags || [],\r\n          readProgress: h.read_progress || 0,\r\n          readDuration: h.read_duration || 0,\r\n          lastReadAt: h.last_read_at\r\n        };\r\n      }).filter(article => article !== null);\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1030\", \"MCP: 获取阅读历史失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取热门文章\r\n  async getHotArticles(limit = 5) {\r\n    try {\r\n      return await this.getArticles({\r\n        isHot: true,\r\n        limit: limit,\r\n        orderBy: 'view_count',\r\n        order: 'desc'\r\n      });\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1045\", \"MCP: 获取热门文章失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // 获取新文章\r\n  async getNewArticles(limit = 10) {\r\n    try {\r\n      return await this.getArticles({\r\n        isNew: true,\r\n        limit: limit,\r\n        orderBy: 'created_at',\r\n        order: 'desc'\r\n      });\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:1058\", \"MCP: 获取新文章失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nclass ConversationService {\r\n  constructor() {\r\n    this.supabaseService = new SupabaseService();\r\n  }\r\n  // 检查Supabase连接\r\n  async checkSupabaseConnection() {\r\n    try {\r\n      const isConnected = this.supabaseService.isConnected;\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:560\", \"Supabase连接状态检查:\", { isConnected });\r\n      return isConnected;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:563\", \"Supabase连接检查失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 创建对话\r\n  async createConversation(title, roleId, styleId) {\r\n    try {\r\n      // 如果没有提供 styleId，使用默认值\r\n      // 默认样式可以根据角色类型选择，或者使用通用的 'friendly' 样式\r\n      const defaultStyleId = styleId || 'friendly';\r\n      const result = await this.supabaseService.createConversation(title, roleId, defaultStyleId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:571\", \"创建对话成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:574\", \"创建对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取用户对话\r\n  async getUserConversations() {\r\n    try {\r\n      const result = await this.supabaseService.getUserConversations();\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:582\", \"获取用户对话成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:585\", \"获取用户对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 保存消息\r\n  async saveMessage(conversationId, role, content) {\r\n    try {\r\n      const result = await this.supabaseService.saveMessage(conversationId, role, content);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:593\", \"保存消息成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:596\", \"保存消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 更新对话标题\r\n  async updateConversationTitle(conversationId, title) {\r\n    try {\r\n      const result = await this.supabaseService.updateConversationTitle(conversationId, title);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:604\", \"更新对话标题成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:607\", \"更新对话标题失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 删除对话\r\n  async deleteConversation(conversationId) {\r\n    try {\r\n      const result = await this.supabaseService.deleteConversation(conversationId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:615\", \"删除对话成功:\", result);\r\n      return result;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:618\", \"删除对话失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  // 获取对话消息\r\n  async getConversationMessages(conversationId) {\r\n    try {\r\n      const result = await this.supabaseService.getConversationMessages(conversationId);\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:633\", \"获取对话消息成功，数量:\", result ? result.length : 0);\r\n      return result || [];\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:636\", \"获取对话消息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // 获取统计信息\r\n  async getConversationStats() {\r\n    try {\r\n      const conversations = await this.getUserConversations();\r\n      const stats = {\r\n        total: conversations.length,\r\n        recent: conversations.filter((conv) => {\r\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\r\n          return new Date(conv.created_at) > oneWeekAgo;\r\n        }).length\r\n      };\r\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:653\", \"获取统计信息成功:\", stats);\r\n      return stats;\r\n    } catch (error) {\r\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:656\", \"获取统计信息失败:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\nconst conversationService = new ConversationService();\r\nexport default conversationService;\r\n//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/supabase.js.map\r\n"],"names":[],"mappings":"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"}