{"version":3,"file":"supabase.js","sources":["utils/supabase.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../common/vendor.js\");\nconst SUPABASE_CONFIG = {\n  url: \"https://etvdmnsernfiegfeadad.supabase.co\",\n  anonKey: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0dmRtbnNlcm5maWVnZmVhZGFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NzM1MDUsImV4cCI6MjA3NzQ0OTUwNX0.FNvK-NrAxGrY5TwYblFC__hScR9lxjC5VFEUPlMYtTY\"\n};\nfunction generateUUID() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0;\n    const v = c === \"x\" ? r : r & 3 | 8;\n    return v.toString(16);\n  });\n}\nfunction isValidUUID(uuid) {\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n  return uuidRegex.test(uuid);\n}\nfunction convertLegacyUserId(legacyId) {\n  if (isValidUUID(legacyId)) {\n    return legacyId;\n  }\n  const hash = legacyId.split(\"\").reduce((a, b) => {\n    a = (a << 5) - a + b.charCodeAt(0);\n    return a & a;\n  }, 0);\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n    const r = (hash + Math.random() * 16) % 16 | 0;\n    const v = c === \"x\" ? r : r & 3 | 8;\n    return v.toString(16);\n  });\n}\nfunction getUserId() {\n  let userId = common_vendor.index.getStorageSync(\"user_id\");\n  if (!userId) {\n    userId = generateUUID();\n    common_vendor.index.setStorageSync(\"user_id\", userId);\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:49\", \"生成新用户ID（UUID格式）:\", userId);\n  } else if (!isValidUUID(userId)) {\n    const newUserId = convertLegacyUserId(userId);\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:53\", \"转换旧用户ID格式:\", userId, \"->\", newUserId);\n    userId = newUserId;\n    common_vendor.index.setStorageSync(\"user_id\", userId);\n  }\n  return userId;\n}\nfunction buildSupabaseQuery(params) {\n  const parts = [];\n  Object.keys(params).forEach((key) => {\n    const value = params[key];\n    if (value !== null && value !== void 0) {\n      if (key === \"select\") {\n        parts.push(`select=${encodeURIComponent(value)}`);\n      } else if (key === \"order\") {\n        parts.push(`order=${encodeURIComponent(value)}`);\n      } else {\n        parts.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\n      }\n    }\n  });\n  return parts.join(\"&\");\n}\nfunction handleSupabaseError(response, url, options) {\n  let errorMessage = `API Error: ${response.statusCode}`;\n  if (response.data) {\n    if (response.data.message) {\n      errorMessage += ` - ${response.data.message}`;\n      if (response.data.message.includes(\"invalid input syntax for type uuid\")) {\n        errorMessage += \" (用户ID格式错误，已自动修复)\";\n        const oldUserId = common_vendor.index.getStorageSync(\"user_id\");\n        const newUserId = generateUUID();\n        common_vendor.index.setStorageSync(\"user_id\", newUserId);\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:100\", \"检测到UUID格式错误，已重新生成用户ID:\", {\n          oldUserId,\n          newUserId\n        });\n      }\n    }\n    if (response.data.hint) {\n      errorMessage += ` (${response.data.hint})`;\n    }\n    if (response.data.details) {\n      errorMessage += ` [${response.data.details}]`;\n    }\n  }\n  common_vendor.index.__f__(\"error\", \"at utils/supabase.js:114\", \"Supabase API错误详情:\", {\n    url,\n    method: options.method,\n    statusCode: response.statusCode,\n    error: errorMessage,\n    responseData: response.data\n  });\n  return new Error(errorMessage);\n}\nasync function migrateUserData() {\n  const oldUserId = common_vendor.index.getStorageSync(\"user_id_legacy\");\n  const currentUserId = common_vendor.index.getStorageSync(\"user_id\");\n  if (!oldUserId && currentUserId && !isValidUUID(currentUserId)) {\n    common_vendor.index.setStorageSync(\"user_id_legacy\", currentUserId);\n    const newUserId = generateUUID();\n    common_vendor.index.setStorageSync(\"user_id\", newUserId);\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:138\", \"执行用户数据迁移:\", {\n      oldUserId: currentUserId,\n      newUserId\n    });\n    return newUserId;\n  }\n  return currentUserId;\n}\nclass SupabaseService {\n  constructor() {\n    this.userId = getUserId();\n    this.isConnected = false;\n    this.initConnection();\n  }\n  // 初始化连接（修复版本）\n  async initConnection() {\n    try {\n      await migrateUserData();\n      if (!isValidUUID(this.userId)) {\n        common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:165\", \"用户ID格式无效，重新生成:\", this.userId);\n        this.userId = generateUUID();\n        common_vendor.index.setStorageSync(\"user_id\", this.userId);\n      }\n      \n      // 直接测试连接，不依赖isConnected状态\n      const testResult = await this.testConnection();\n      this.isConnected = true;\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:172\", \"Supabase MCP连接成功，用户ID:\", this.userId);\n      return testResult;\n    } catch (error) {\n      common_vendor.index.__f__(\"warn\", \"at utils/supabase.js:174\", \"Supabase MCP连接失败，将使用降级方案:\", error);\n      this.isConnected = false;\n      throw error;\n    }\n  }\n  // 测试连接（修复版本）\n  async testConnection() {\n    const url = `${SUPABASE_CONFIG.url}/rest/v1/conversations?limit=1`;\n    const options = {\n      method: \"GET\",\n      header: {\n        \"apikey\": SUPABASE_CONFIG.anonKey,\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\n        \"Content-Type\": \"application/json\"\n      },\n      timeout: 10e3\n    };\n    \n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:175\", \"测试Supabase连接:\", url);\n    \n    try {\n      const response = await common_vendor.index.request({\n        url,\n        ...options\n      });\n      \n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:183\", \"连接测试响应状态码:\", response.statusCode);\n      \n      if (response.statusCode >= 200 && response.statusCode < 300) {\n        return response.data;\n      } else {\n        throw handleSupabaseError(response, url, options);\n      }\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:191\", \"Supabase连接测试失败:\", error);\n      throw error;\n    }\n  }\n  // API调用方法\n  async callApi(endpoint, options = {}) {\n    if (!this.isConnected) {\n      throw new Error(\"Supabase连接不可用，请检查网络连接\");\n    }\n    let url = `${SUPABASE_CONFIG.url}/rest/v1/${endpoint}`;\n    const defaultOptions = {\n      method: \"GET\",\n      header: {\n        \"apikey\": SUPABASE_CONFIG.anonKey,\n        \"Authorization\": `Bearer ${SUPABASE_CONFIG.anonKey}`,\n        \"Content-Type\": \"application/json\",\n        \"Prefer\": \"return=representation\"\n      },\n      timeout: 15e3\n    };\n    if (options.queryParams) {\n      const queryString = buildSupabaseQuery(options.queryParams);\n      if (queryString) {\n        url += \"?\" + queryString;\n      }\n    }\n    const finalOptions = {\n      ...defaultOptions,\n      ...options,\n      url,\n      header: {\n        ...defaultOptions.header,\n        ...options.header || {}\n      }\n    };\n    if ((options.method === \"POST\" || options.method === \"PATCH\") && options.data) {\n      finalOptions.data = JSON.stringify(options.data);\n    }\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:236\", `MCP API调用: ${finalOptions.method} ${url}`);\n    common_vendor.index.__f__(\"log\", \"at utils/supabase.js:237\", \"查询参数:\", options.queryParams);\n    try {\n      const response = await common_vendor.index.request(finalOptions);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:242\", \"API响应状态码:\", response.statusCode);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:243\", \"API响应数据:\", response.data);\n      if (response.statusCode >= 200 && response.statusCode < 300) {\n        return response.data;\n      } else {\n        throw handleSupabaseError(response, url, options);\n      }\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:251\", \"Supabase API调用失败:\", error);\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:252\", \"请求详情:\", {\n        url,\n        method: finalOptions.method,\n        headers: finalOptions.header\n      });\n      throw error;\n    }\n  }\n  // 创建新对话（修复版本）\n  async createConversation(title, roleId, styleId) {\n    try {\n      const data = {\n        user_id: this.userId,\n        title: title || \"新对话\",\n        role_id: roleId,\n        style_id: styleId,\n        is_active: true,\n        created_at: (/* @__PURE__ */ new Date()).toISOString(),\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:274\", \"MCP: 创建对话，数据:\", data);\n      const result = await this.callApi(\"conversations\", {\n        method: \"POST\",\n        header: {\n          \"Content-Type\": \"application/json\",\n          \"Prefer\": \"return=representation\"\n        },\n        data\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:285\", \"MCP: 创建对话成功:\", result);\n      return result ? result[0] : null;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:288\", \"MCP: 创建对话失败:\", error);\n      throw error;\n    }\n  }\n  // 获取用户的所有对话（修复HTTP 400错误）\n  async getUserConversations() {\n    try {\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:296\", \"MCP: 获取用户对话，用户ID:\", this.userId);\n      const result = await this.callApi(\"conversations\", {\n        method: \"GET\",\n        queryParams: {\n          user_id: `eq.${this.userId}`,\n          is_active: \"eq.true\",\n          select: \"*\"\n        }\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:307\", \"MCP: 获取对话成功，数量:\", result ? result.length : 0);\n      return result || [];\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:310\", \"MCP: 获取用户对话失败:\", error);\n      return [];\n    }\n  }\n  // 获取对话的详细信息（修复版本）\n  async getConversation(conversationId) {\n    try {\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:319\", \"MCP: 获取对话详情，对话ID:\", conversationId);\n      const result = await this.callApi(\"conversations\", {\n        method: \"GET\",\n        queryParams: {\n          id: `eq.${conversationId}`,\n          select: \"*\"\n        }\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:329\", \"MCP: 获取对话详情成功:\", result ? result[0] : null);\n      return result ? result[0] : null;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:332\", \"MCP: 获取对话详情失败:\", error);\n      return null;\n    }\n  }\n  // 获取对话的所有消息（修复版本）\n  async getConversationMessages(conversationId) {\n    try {\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:340\", \"MCP: 获取对话消息，对话ID:\", conversationId);\n      const result = await this.callApi(\"messages\", {\n        method: \"GET\",\n        queryParams: {\n          conversation_id: `eq.${conversationId}`,\n          order: \"created_at.asc\",\n          select: \"*\"\n        }\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:351\", \"MCP: 获取消息成功，数量:\", result ? result.length : 0);\n      return result || [];\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:354\", \"MCP: 获取对话消息失败:\", error);\n      return [];\n    }\n  }\n  // 保存消息（修复版本）\n  async saveMessage(conversationId, role, content) {\n    try {\n      const data = {\n        conversation_id: conversationId,\n        role,\n        content,\n        created_at: (/* @__PURE__ */ new Date()).toISOString()\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:369\", \"MCP: 保存消息，数据:\", data);\n      const result = await this.callApi(\"messages\", {\n        method: \"POST\",\n        header: {\n          \"Content-Type\": \"application/json\",\n          \"Prefer\": \"return=representation\"\n        },\n        data\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:380\", \"MCP: 保存消息成功:\", result);\n      return result ? result[0] : null;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:383\", \"MCP: 保存消息失败:\", error);\n      throw error;\n    }\n  }\n  // 更新对话标题（修复版本）\n  async updateConversationTitle(conversationId, title) {\n    try {\n      const data = {\n        title,\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:396\", \"MCP: 更新对话标题，对话ID:\", conversationId, \"标题:\", title);\n      const result = await this.callApi(\"conversations\", {\n        method: \"PATCH\",\n        queryParams: {\n          id: `eq.${conversationId}`\n        },\n        data\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:406\", \"MCP: 更新对话标题成功:\", result);\n      return result ? result[0] : null;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:409\", \"MCP: 更新对话标题失败:\", error);\n      throw error;\n    }\n  }\n  // 删除对话（软删除，修复版本）\n  async deleteConversation(conversationId) {\n    try {\n      const data = {\n        is_active: false,\n        updated_at: (/* @__PURE__ */ new Date()).toISOString()\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:422\", \"MCP: 删除对话，对话ID:\", conversationId);\n      const result = await this.callApi(\"conversations\", {\n        method: \"PATCH\",\n        queryParams: {\n          id: `eq.${conversationId}`\n        },\n        data\n      });\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:432\", \"MCP: 删除对话成功:\", result);\n      return result ? result[0] : null;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:435\", \"MCP: 删除对话失败:\", error);\n      throw error;\n    }\n  }\n  // 获取对话统计信息（修复版本）\n  async getConversationStats() {\n    try {\n      const conversations = await this.getUserConversations();\n      const stats = {\n        total: conversations.length,\n        recent: conversations.filter((conv) => {\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\n          return new Date(conv.created_at) > oneWeekAgo;\n        }).length\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:453\", \"MCP: 获取统计信息成功:\", stats);\n      return stats;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:456\", \"MCP: 获取统计信息失败:\", error);\n      return { total: 0, recent: 0 };\n    }\n  }\n}\n\nclass ConversationService {\n  constructor() {\n    this.supabaseService = new SupabaseService();\n  }\n  // 检查Supabase连接\n  async checkSupabaseConnection() {\n    try {\n      const isConnected = this.supabaseService.isConnected;\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:560\", \"Supabase连接状态检查:\", { isConnected });\n      return isConnected;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:563\", \"Supabase连接检查失败:\", error);\n      throw error;\n    }\n  }\n  // 创建对话\n  async createConversation(title, roleId, styleId) {\n    try {\n      const result = await this.supabaseService.createConversation(title, roleId, styleId);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:571\", \"创建对话成功:\", result);\n      return result;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:574\", \"创建对话失败:\", error);\n      throw error;\n    }\n  }\n  // 获取用户对话\n  async getUserConversations() {\n    try {\n      const result = await this.supabaseService.getUserConversations();\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:582\", \"获取用户对话成功，数量:\", result ? result.length : 0);\n      return result || [];\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:585\", \"获取用户对话失败:\", error);\n      throw error;\n    }\n  }\n  // 保存消息\n  async saveMessage(conversationId, role, content) {\n    try {\n      const result = await this.supabaseService.saveMessage(conversationId, role, content);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:593\", \"保存消息成功:\", result);\n      return result;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:596\", \"保存消息失败:\", error);\n      throw error;\n    }\n  }\n  // 更新对话标题\n  async updateConversationTitle(conversationId, title) {\n    try {\n      const result = await this.supabaseService.updateConversationTitle(conversationId, title);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:604\", \"更新对话标题成功:\", result);\n      return result;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:607\", \"更新对话标题失败:\", error);\n      throw error;\n    }\n  }\n  // 删除对话\n  async deleteConversation(conversationId) {\n    try {\n      const result = await this.supabaseService.deleteConversation(conversationId);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:615\", \"删除对话成功:\", result);\n      return result;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:618\", \"删除对话失败:\", error);\n      throw error;\n    }\n  }\n  // 获取对话消息\n  async getConversationMessages(conversationId) {\n    try {\n      const result = await this.supabaseService.getConversationMessages(conversationId);\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:633\", \"获取对话消息成功，数量:\", result ? result.length : 0);\n      return result || [];\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:636\", \"获取对话消息失败:\", error);\n      throw error;\n    }\n  }\n\n  // 获取统计信息\n  async getConversationStats() {\n    try {\n      const conversations = await this.getUserConversations();\n      const stats = {\n        total: conversations.length,\n        recent: conversations.filter((conv) => {\n          const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1e3);\n          return new Date(conv.created_at) > oneWeekAgo;\n        }).length\n      };\n      common_vendor.index.__f__(\"log\", \"at utils/supabase.js:653\", \"获取统计信息成功:\", stats);\n      return stats;\n    } catch (error) {\n      common_vendor.index.__f__(\"error\", \"at utils/supabase.js:656\", \"获取统计信息失败:\", error);\n      throw error;\n    }\n  }\n}\nconst conversationService = new ConversationService();\nexport default conversationService;\n//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/supabase.js.map\n"],"names":[],"mappings":"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"}